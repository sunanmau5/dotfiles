#!/usr/bin/env bash

# uses PROJECT_DIRS and STANDALONE_PROJECTS from ~/.config/zsh/variables.sh

selected="${1:-$({ find $PROJECT_DIRS -mindepth 1 -maxdepth 1 -type d 2>/dev/null; echo "$STANDALONE_PROJECTS"; } | fzf)}"
[[ -z "$selected" ]] && exit 0

selected="${selected//\\/}"
selected_name=$(basename "$selected" | tr '. ' '__')

# create session if it doesn't exist
if ! tmux has-session -t="$selected_name" 2>/dev/null; then
  tmux new-session -ds "$selected_name" -c "$selected"
fi

# attach or switch
[[ -z "$TMUX" ]] && tmux attach -t "$selected_name" || tmux switch-client -t "$selected_name"
